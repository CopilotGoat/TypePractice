<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <header>
        <h1>Typing Practice Website</h1>
        <nav>
            <ul>
                <li><a href="./index-old.html">홈</a></li>
                <li><a href="#Practice">Practice</a></li>
                <li><a href="./ranking.html">랭킹</a></li>
            </ul>
        </nav>
    </header>
    <div id="main">
        <table id="ranking">
            <thead>
                <tr>
                    <th>순위</th>
                    <th>
                        <select id="book" aria-label="어떤 랭킹?">
                            <option value="0">책을 선택해주세요</option>
                        </select>
                    </th>
                    <th>닉네임</th>
                    <th>점수</th>
                    <th>걸린시간</th>
                </tr>
            </thead>
            <tbody id="rankingRow">
            </tbody>
        </table>
    </div>
    <script>
        const apiUrl = 'https://ai.csnewcs.dev:8080/'
        const bookSelect = document.getElementById('book')
        window.onload = fetch(apiUrl + 'book').then(res => res.json()).then(data => {
            data.forEach(book => {
                const option = document.createElement('option')
                option.value = book.id
                option.innerText = book.title
                bookSelect.appendChild(option)
            })
            console.log(data)
        })
        bookSelect.onchange = () => {
            let row = document.getElementById('rankingRow')
            row.innerHTML = ''
            fetch(apiUrl + 'ranking?bookId=' + bookSelect.value).then(res => res.json()).then(data => {
                console.log(data)
                const info = document.createElement('td')
                for (let i = 0; i < data.length; i++) {
                    const tr = document.createElement('tr')
                    tr.id = 'rankingRow'
                    const rank = document.createElement('td')
                    const username = document.createElement('td')
                    const score = document.createElement('td')
                    const takenTime = document.createElement('td')
                    const book = document.createElement('td')
                    rank.innerText = i + 1
                    username.innerText =data[i].username
                    score.innerText =data[i].score
                    takenTime.innerText = data[i].takenTime
                    book.innerText = document.getElementById('book').options[document.getElementById('book').selectedIndex].text
                    tr.appendChild(rank)
                    tr.appendChild(book)
                    tr.appendChild(username)
                    tr.appendChild(score)
                    tr.appendChild(takenTime)
                    row.appendChild(tr)
                }
            })
        }
    </script>
</body>
</html>